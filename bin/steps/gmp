#!/usr/bin/env bash

# This script serves as the GNU GMP build step of the
# [**Freicoin Python Buildpack**](https://github.com/freicoin/buildpack-python)
# compiler.
#
# A [buildpack](http://devcenter.heroku.com/articles/buildpacks) is an
# adapter between a Python application and Heroku's runtime.
#
# This script is invoked by [`bin/compile`](/).

# Syntax sugar.
source $BIN_DIR/utils

VERSION=5.1.2
SOURCE=gmp-${VERSION}.tar.xz
CHECKSUM=e87015a825a2445e169931ee27849d52576a2d9e338d1383dcb36fed68d0006f
URL=ftp://ftp.gmplib.org/pub/gmp-${VERSION}/${SOURCE}
URL_2=ftp://ftp.cs.tu-berlin.de/pub/gnu/gmp/${SOURCE}

puts-step "Installing GMP ${VERSION}"

pushd .heroku
PREFIX=$(pwd)/vendor

curl -s -L -o ${SOURCE} ${URL} || curl -s -L -o ${SOURCE} ${URL_2}
tar -xf ${SOURCE} > /dev/null
rm ${SOURCE}

pushd gmp-${VERSION}
./configure --enable-shared --enable-cxx --prefix="${PREFIX}"
make && make install
popd
rm -rf gmp-${VERSION}

popd

export CFLAGS=-I"${PREFIX}/include"
export LDFLAGS=-L"${PREFIX}/lib"
