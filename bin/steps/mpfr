#!/usr/bin/env bash

# This script serves as the MPFR build step of the
# [**Freicoin Python Buildpack**](https://github.com/freicoin/buildpack-python)
# compiler.
#
# A [buildpack](http://devcenter.heroku.com/articles/buildpacks) is an
# adapter between a Python application and Heroku's runtime.
#
# This script is invoked by [`bin/compile`](/).

# Syntax sugar.
source $BIN_DIR/utils

VERSION=3.1.2
SOURCE=mpfr-${VERSION}.tar.xz
CHECKSUM=49d5acc32dbeec30a8e26af9c19845763d63feacb8bf97b12876008419f5a17a
URL=ftp://ftp.gnu.org/pub/gnu/${SOURCE}/${SOURCE}
URL_2=http://www.mpfr.org/mpfr-${VERSION}/${SOURCE}

puts-step "Installing MPFR ${VERSION}"

pushd .heroku
PREFIX=$(pwd)/vendor

curl -s -L -o ${SOURCE} ${URL} || curl -s -L -o ${SOURCE} ${URL_2}
tar -xf ${SOURCE} > /dev/null
rm ${SOURCE}

pushd mpfr-${VERSION}
./configure --enable-shared --with-gmp="${PREFIX}" --prefix="${PREFIX}"
make && make install
popd
rm -rf mpfr-${VERSION}

popd

export CFLAGS=-I"${PREFIX}/include"
export LDFLAGS=-L"${PREFIX}/lib"
